{"remainingRequest":"/home/clement/APIetienne/bccoin/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/clement/APIetienne/bccoin/src/components/shop/StripePaiement.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/clement/APIetienne/bccoin/src/components/shop/StripePaiement.vue","mtime":1607801764748},{"path":"/home/clement/APIetienne/bccoin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/clement/APIetienne/bccoin/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/clement/APIetienne/bccoin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/clement/APIetienne/bccoin/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnU3RyaXBlUGFpZW1lbnQnLAogIHByb3BzOiBbCiAgICAibnVtYmVyQ29pbiIsCiAgICAidXNlcklkIiwKICAgICJ1c2VyTmFtZSIKICBdLAogIGRhdGEoKSB7CiAgIHJldHVybnsKICAgICBudW1iZXI6IHRoaXMubnVtYmVyQ29pbiwKICAgICBzdHJpcGVBUElUb2tlbjogJ3BrX3Rlc3RfNTFIc1VVSkVqMTRPaGlwS1VhdldjVzQ4WmRFVjF5V21GSENXMHljRGlhOVI4T3pEZlczdjQ4Z2h6RFdqNTVab2p0UmR4RHZNSTduajFmYVY5TmtxTmVTcFcwMDB2ZUQ3eENGJywKICAgICBzdHJpcGU6ICcnLAogICAgIGVsZW1lbnRzOiAnJywKICAgICBjYXJkOiAnJwogICB9CiAgfSwKICBtZXRob2RzOnsKICAgIC8vaW5jbHVkZSBTdHJpcGUKICAgIGluY2x1ZGVTdHJpcGUoIFVSTCwgY2FsbGJhY2sgKXsKICAgICAgICBjb25zb2xlLmxvZygndG90bycpCiAgICAgICAgbGV0IGRvY3VtZW50VGFnID0gZG9jdW1lbnQsIHRhZyA9ICdzY3JpcHQnLAogICAgICAgICAgICBvYmplY3QgPSBkb2N1bWVudFRhZy5jcmVhdGVFbGVtZW50KHRhZyksCiAgICAgICAgICAgIHNjcmlwdFRhZyA9IGRvY3VtZW50VGFnLmdldEVsZW1lbnRzQnlUYWdOYW1lKHRhZylbMF07CiAgICAgICAgb2JqZWN0LnNyYyA9ICcvLycgKyBVUkw7CiAgICAgICAgaWYgKGNhbGxiYWNrKSB7IG9iamVjdC5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24gKGUpIHsgY2FsbGJhY2sobnVsbCwgZSk7IH0sIGZhbHNlKTsgfQogICAgICAgIHNjcmlwdFRhZy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShvYmplY3QsIHNjcmlwdFRhZyk7CiAgICB9LAogICAgLyoKICAgIENvbmZpZ3VyZXMgU3RyaXBlIGJ5IHNldHRpbmcgdXAgdGhlIGVsZW1lbnRzIGFuZCAKICAgIGNyZWF0aW5nIHRoZSBjYXJkIGVsZW1lbnQuCiAgICAqLwogICBwb3N0VG9MYXJhdmVsKHRva2VuLCBudW1iZXIpewogICAgICAgICAgIC8qIHZhciBheGlvcyA9IHJlcXVpcmUoJ2F4aW9zJyk7CiAgICAgICAgICAgIHZhciBkYXRhID0gSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICJzdHJpcGVUb2tlbiI6IHRva2VuLAogICAgICAgICAgICAgICJ0b2tlbk51bWJlciI6IG51bWJlcgogICAgICAgICAgICB9KTsqLwoKICAgICAgICAgICAgLy8vLy8vCiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRva2VuKQogICAgICAgICAgICBjb25zb2xlLmxvZyhudW1iZXIpCiAgICAgICAgICAgIHZhciBheGlvcyA9IHJlcXVpcmUoJ2F4aW9zJyk7CiAgICAgICAgICAgIHZhciBkYXRhID0gSlNPTi5zdHJpbmdpZnkoeyJzdHJpcGVUb2tlbiI6dG9rZW4sInRva2VuTnVtYmVyIjpudW1iZXJ9KTsKCiAgICAgICAgICAgIHZhciBjb25maWcgPSB7CiAgICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsCiAgICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9oYXV0ZS1sb2lyZS5vcmcvYXBpL3N0cmlwZScsCiAgICAgICAgICAgICAgaGVhZGVyczogeyAKICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGRhdGEgOiBkYXRhCiAgICAgICAgICAgIH07CgoKICAgICAgICAgICAgLy8vLy8vCgogICAgICAgICAgICAvKnZhciBjb25maWcgPSB7CiAgICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsCiAgICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9oYXV0ZS1sb2lyZS5vcmcvYXBpL3N0cmlwZScsCiAgICAgICAgICAgICAgZGF0YSA6IGRhdGEKICAgICAgICAgICAgfTsqLwoKICAgICAgICAgICAgYXhpb3MoY29uZmlnKQogICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShyZXNwb25zZS5kYXRhKSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgICAgICAgIH0pOwogICAgICAgIAogICAgfSwKICAgIGJhbmtUb2tlbihpZERvbm9yLCBhbW91bnQpewogICAgICAgIHZhciBheGlvcyA9IHJlcXVpcmUoJ2F4aW9zJyk7CiAgICAgICAgdmFyIGRhdGEgPSBKU09OLnN0cmluZ2lmeSh7ImlkX2Rvbm9yIjogMSwiaWRfcmVjZWl2ZXIiOiBpZERvbm9yLCJhbW91bnQiOiBhbW91bnR9KTsKCiAgICAgICAgY29uc29sZS5sb2coaWREb25vciwgYW1vdW50KQoKICAgICAgICB2YXIgY29uZmlnID0gewogICAgICAgICAgbWV0aG9kOiAncG9zdCcsCiAgICAgICAgICB1cmw6ICdodHRwczovL2hhdXRlLWxvaXJlLm9yZy9hcGkvdHJhbnNhY3Rpb24nLAogICAgICAgICAgaGVhZGVyczogeyAKICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJwogICAgICAgICAgfSwKICAgICAgICAgIGRhdGEgOiBkYXRhCiAgICAgICAgfTsKCiAgICAgICAgYXhpb3MoY29uZmlnKQogICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UuZGF0YSkpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOwogICAgICAgIH0pOwogICAgfSwKICAgIGNvbmZpZ3VyZVN0cmlwZShmb25jdGlvbiwgbnVtYmVyKXsKICAgICAgY29uc29sZS5sb2coJ3RvdG8nKQogICAgICB2YXIgc3RyaXBlID0gd2luZG93LlN0cmlwZSggdGhpcy5zdHJpcGVBUElUb2tlbiApOwoKICAgICAgICB2YXIgZWxlbWVudHMgPSBzdHJpcGUuZWxlbWVudHMoKQogICAgICAgIAogICAgICAgIC8qCiAgICAgICAgY29uc3QgY2FyZCA9IHN0cmlwZS5jaGFyZ2VzLmNyZWF0ZSh7CiAgICAgICAgICBhbW91bnQ6IDIwMDAsCiAgICAgICAgICBjdXJyZW5jeTogJ2V1cicsCiAgICAgICAgICBzb3VyY2U6ICd0b2tfdmlzYScsCiAgICAgICAgICBkZXNjcmlwdGlvbjogJ015IEZpcnN0IFRlc3QgQ2hhcmdlIChjcmVhdGVkIGZvciBBUEkgZG9jcyknLAogICAgICAgIH0pOyovCgogICAgICAgIHZhciBjYXJkID0gZWxlbWVudHMuY3JlYXRlKCdjYXJkJyk7CgogICAgICAgIGNhcmQubW91bnQoJyNjYXJkLWVsZW1lbnQnKTsKICAgICAgICAvLyBIYW5kbGUgZm9ybSBzdWJtaXNzaW9uLgogICAgICAgIHZhciBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BheW1lbnQtZm9ybScpOwogICAgICAgIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgCiAgICAgICAgICBzdHJpcGUuY3JlYXRlVG9rZW4oY2FyZCkudGhlbihmdW5jdGlvbihyZXN1bHQpIHsKICAgICAgICAgICAgaWYgKHJlc3VsdC5lcnJvcikgewogICAgICAgICAgICAgIC8vIEluZm9ybSB0aGUgdXNlciBpZiB0aGVyZSB3YXMgYW4gZXJyb3IuCiAgICAgICAgICAgICAgdmFyIGVycm9yRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYXJkLWVycm9ycycpOwogICAgICAgICAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IHJlc3VsdC5lcnJvci5tZXNzYWdlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIFNlbmQgdGhlIHRva2VuIHRvIHlvdXIgc2VydmVyLgogICAgICAgICAgICAgIC8vc3RyaXBlVG9rZW5IYW5kbGVyKHJlc3VsdC50b2tlbik7CiAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0LnRva2VuLmlkKQogICAgICAgICAgICAgIGNvbnNvbGUubG9nKG51bWJlcikKICAgICAgICAgICAgICBmb25jdGlvbihyZXN1bHQudG9rZW4uaWQsIG51bWJlcikgICAgIAogICAgICAgICAgICAgIC8vY29uc29sZS5sb2cobnVtYmVyKSAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgIH0pCgogICAgICAgIC8qCiAgICAgICAgZnVuY3Rpb24gc3RyaXBlVG9rZW5IYW5kbGVyKHRva2VuKSB7CiAgICAgICAgICAvLyBJbnNlcnQgdGhlIHRva2VuIElEIGludG8gdGhlIGZvcm0gc28gaXQgZ2V0cyBzdWJtaXR0ZWQgdG8gdGhlIHNlcnZlcgogICAgICAgICAgdmFyIGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGF5bWVudC1mb3JtJyk7CiAgICAgICAgICB2YXIgaGlkZGVuSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwogICAgICAgICAgaGlkZGVuSW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ2hpZGRlbicpOwogICAgICAgICAgaGlkZGVuSW5wdXQuc2V0QXR0cmlidXRlKCduYW1lJywgJ3N0cmlwZVRva2VuJyk7CiAgICAgICAgICBoaWRkZW5JbnB1dC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgdG9rZW4uaWQpOwogICAgICAgICAgZm9ybS5hcHBlbmRDaGlsZChoaWRkZW5JbnB1dCk7CgogICAgICAgICAgCiAgICAgICAgICAvLyBTdWJtaXQgdGhlIGZvcm0KICAgICAgICAgIGZvcm0uc3VibWl0KCk7CiAgICAgICAgfSovCiAgICAgICAgLy8gSGFuZGxlIHJlYWwtdGltZSB2YWxpZGF0aW9uIGVycm9ycyBmcm9tIHRoZSBjYXJkIEVsZW1lbnQuCiAgICAgICAgY2FyZC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgdmFyIGRpc3BsYXlFcnJvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYXJkLWVycm9ycycpOwogICAgICAgICAgaWYgKGV2ZW50LmVycm9yKSB7CiAgICAgICAgICAgIGRpc3BsYXlFcnJvci50ZXh0Q29udGVudCA9IGV2ZW50LmVycm9yLm1lc3NhZ2U7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkaXNwbGF5RXJyb3IudGV4dENvbnRlbnQgPSAnJzsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICB9LAogICAgbW91bnRlZCgpewogICAgICBjb25zb2xlLmxvZygndG90bycpCiAgICAgIHRoaXMuaW5jbHVkZVN0cmlwZSgnanMuc3RyaXBlLmNvbS92My8nLCBmdW5jdGlvbigpewogICAgICAgICAgICB0aGlzLmNvbmZpZ3VyZVN0cmlwZSgpOwogICAgICAgIH0uYmluZCh0aGlzKSApOwogICAgICB9CiAgICB9LAogICAgY3JlYXRlZCgpewogICAgICBjb25zdCBmb25jdGlvbiA9IHRoaXMucG9zdFRvTGFyYXZlbAogICAgICB0aGlzLmluY2x1ZGVTdHJpcGUoJ2pzLnN0cmlwZS5jb20vdjMvJywgZnVuY3Rpb24oKXsKICAgICAgICAgICAgdGhpcy5jb25maWd1cmVTdHJpcGUoZm9uY3Rpb24sIHRoaXMubnVtYmVyKTsKICAgICAgICB9LmJpbmQodGhpcykgKTsgIAogICAgfSAKfQo="},{"version":3,"sources":["StripePaiement.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAsBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"StripePaiement.vue","sourceRoot":"src/components/shop","sourcesContent":["<template>\n    <div>\n        You want to buy {{number}} coins.\n        <form id=\"payment-form\">\n        <div>\n            <label for=\"card-element\">\n            Credit or debit card\n            </label>\n            <div id=\"card-element\">\n            <!-- A Stripe Element will be inserted here. -->\n            </div>\n    \n            <!-- Used to display form errors. -->\n            <div id=\"card-errors\" role=\"alert\"></div>\n        </div>\n    \n        <button class=\"buttonpay\" v-on:click=\"bankToken(userId, number)\">Payer</button>\n        </form>\n    </div>\n</template>\n\n<script>\nexport default {\n  name: 'StripePaiement',\n  props: [\n    \"numberCoin\",\n    \"userId\",\n    \"userName\"\n  ],\n  data() {\n   return{\n     number: this.numberCoin,\n     stripeAPIToken: 'pk_test_51HsUUJEj14OhipKUavWcW48ZdEV1yWmFHCW0ycDia9R8OzDfW3v48ghzDWj55ZojtRdxDvMI7nj1faV9NkqNeSpW000veD7xCF',\n     stripe: '',\n     elements: '',\n     card: ''\n   }\n  },\n  methods:{\n    //include Stripe\n    includeStripe( URL, callback ){\n        console.log('toto')\n        let documentTag = document, tag = 'script',\n            object = documentTag.createElement(tag),\n            scriptTag = documentTag.getElementsByTagName(tag)[0];\n        object.src = '//' + URL;\n        if (callback) { object.addEventListener('load', function (e) { callback(null, e); }, false); }\n        scriptTag.parentNode.insertBefore(object, scriptTag);\n    },\n    /*\n    Configures Stripe by setting up the elements and \n    creating the card element.\n    */\n   postToLaravel(token, number){\n           /* var axios = require('axios');\n            var data = JSON.stringify({\n              \"stripeToken\": token,\n              \"tokenNumber\": number\n            });*/\n\n            //////\n            console.log(token)\n            console.log(number)\n            var axios = require('axios');\n            var data = JSON.stringify({\"stripeToken\":token,\"tokenNumber\":number});\n\n            var config = {\n              method: 'post',\n              url: 'https://haute-loire.org/api/stripe',\n              headers: { \n                'Content-Type': 'application/json'\n              },\n              data : data\n            };\n\n\n            //////\n\n            /*var config = {\n              method: 'post',\n              url: 'https://haute-loire.org/api/stripe',\n              data : data\n            };*/\n\n            axios(config)\n            .then(function (response) {\n              console.log(JSON.stringify(response.data));\n            })\n            .catch(function (error) {\n              console.log(error);\n            });\n        \n    },\n    bankToken(idDonor, amount){\n        var axios = require('axios');\n        var data = JSON.stringify({\"id_donor\": 1,\"id_receiver\": idDonor,\"amount\": amount});\n\n        console.log(idDonor, amount)\n\n        var config = {\n          method: 'post',\n          url: 'https://haute-loire.org/api/transaction',\n          headers: { \n            'Content-Type': 'application/json'\n          },\n          data : data\n        };\n\n        axios(config)\n        .then(function (response) {\n          console.log(JSON.stringify(response.data));\n        })\n        .catch(function (error) {\n          console.log(error);\n        });\n    },\n    configureStripe(fonction, number){\n      console.log('toto')\n      var stripe = window.Stripe( this.stripeAPIToken );\n\n        var elements = stripe.elements()\n        \n        /*\n        const card = stripe.charges.create({\n          amount: 2000,\n          currency: 'eur',\n          source: 'tok_visa',\n          description: 'My First Test Charge (created for API docs)',\n        });*/\n\n        var card = elements.create('card');\n\n        card.mount('#card-element');\n        // Handle form submission.\n        var form = document.getElementById('payment-form');\n        form.addEventListener('submit', function(event) {\n          event.preventDefault();\n        \n          stripe.createToken(card).then(function(result) {\n            if (result.error) {\n              // Inform the user if there was an error.\n              var errorElement = document.getElementById('card-errors');\n              errorElement.textContent = result.error.message;\n            } else {\n              // Send the token to your server.\n              //stripeTokenHandler(result.token);\n              console.log(result.token.id)\n              console.log(number)\n              fonction(result.token.id, number)     \n              //console.log(number)         \n            }\n          })\n        })\n\n        /*\n        function stripeTokenHandler(token) {\n          // Insert the token ID into the form so it gets submitted to the server\n          var form = document.getElementById('payment-form');\n          var hiddenInput = document.createElement('input');\n          hiddenInput.setAttribute('type', 'hidden');\n          hiddenInput.setAttribute('name', 'stripeToken');\n          hiddenInput.setAttribute('value', token.id);\n          form.appendChild(hiddenInput);\n\n          \n          // Submit the form\n          form.submit();\n        }*/\n        // Handle real-time validation errors from the card Element.\n        card.addEventListener('change', function(event) {\n          var displayError = document.getElementById('card-errors');\n          if (event.error) {\n            displayError.textContent = event.error.message;\n          } else {\n            displayError.textContent = '';\n          }\n        });\n\n    },\n    mounted(){\n      console.log('toto')\n      this.includeStripe('js.stripe.com/v3/', function(){\n            this.configureStripe();\n        }.bind(this) );\n      }\n    },\n    created(){\n      const fonction = this.postToLaravel\n      this.includeStripe('js.stripe.com/v3/', function(){\n            this.configureStripe(fonction, this.number);\n        }.bind(this) );  \n    } \n}\n</script> \n<style scoped>\n.buttonpay {\n\n      color: white;\n      background-color: #ffa008;;\n      border: none;\n      padding: 15px;\n      border-radius: 3em;\n      font-weight: bold;\n      margin-top: 2em;\n  }\n</style>"]}]}