{"remainingRequest":"/home/clement/APIetienne/bccoin/node_modules/babel-loader/lib/index.js!/home/clement/APIetienne/bccoin/node_modules/eslint-loader/index.js??ref--13-0!/home/clement/APIetienne/bccoin/src/store/auth.js","dependencies":[{"path":"/home/clement/APIetienne/bccoin/src/store/auth.js","mtime":1607801764748},{"path":"/home/clement/APIetienne/bccoin/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/clement/APIetienne/bccoin/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/clement/APIetienne/bccoin/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiL2hvbWUvY2xlbWVudC9BUElldGllbm5lL2JjY29pbi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lc3BhY2VkOiB0cnVlLAogIHN0YXRlOiB7CiAgICB0b2tlbjogbnVsbCwKICAgIHVzZXI6IG51bGwKICB9LAogIGdldHRlcnM6IHsKICAgIGF1dGhlbnRpY2F0ZWQ6IGZ1bmN0aW9uIGF1dGhlbnRpY2F0ZWQoc3RhdGUpIHsKICAgICAgLy8gcmV0b3VybiB0cnVlIHNpIGlsIHkgYSB1biB0b2tlbiArIHVzZXIgZGFucyBsZSBzdGF0ZSwgZmFsc2Ugc2lub24KICAgICAgLy92YXIgZXN0ID0gZmFsc2U7CiAgICAgIGlmIChzdGF0ZS50b2tlbiAmJiBzdGF0ZS51c2VyKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9LAogICAgdXNlcjogZnVuY3Rpb24gdXNlcihzdGF0ZSkgewogICAgICAvL3JldG91cm5lIGwndXRpbGlzYXR1ZXIKICAgICAgcmV0dXJuIHN0YXRlLnVzZXI7CiAgICB9CiAgfSwKICBtdXRhdGlvbnM6IHsKICAgIFNFVF9UT0tFTjogZnVuY3Rpb24gU0VUX1RPS0VOKHN0YXRlLCB0b2tlbikgewogICAgICBzdGF0ZS50b2tlbiA9IHRva2VuOwogICAgfSwKICAgIFNFVF9VU0VSOiBmdW5jdGlvbiBTRVRfVVNFUihzdGF0ZSwgdXNlcikgewogICAgICBzdGF0ZS51c2VyID0gdXNlcjsKICAgIH0KICB9LAogIGFjdGlvbnM6IHsKICAgIHNpZ25pbjogZnVuY3Rpb24gc2lnbmluKF9yZWYsIGNyZWRlbnRpYWxzKSB7CiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIGRpc3BhdGNoLCByZXM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgZGlzcGF0Y2ggPSBfcmVmLmRpc3BhdGNoOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gYXhpb3MucG9zdCgnaHR0cHM6Ly9oYXV0ZS1sb2lyZS5vcmcvYXBpL2F1dGgvc2lnbmluJywgewogICAgICAgICAgICAgICAgICAvL3bDqXJpZmllIHNpIG1haWwgZXQgbWRwIHNvbnQgbGVzIGJvbnMKICAgICAgICAgICAgICAgICAgJ2VtYWlsJzogY3JlZGVudGlhbHNbMF0sCiAgICAgICAgICAgICAgICAgICdwYXNzd29yZCc6IGNyZWRlbnRpYWxzWzFdCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGRpc3BhdGNoKCdhdHRlbXB0JywgcmVzLmRhdGEudG9rZW4pKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIGF0dGVtcHQ6IGZ1bmN0aW9uIGF0dGVtcHQoX3JlZjIsIHRva2VuKSB7CiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgIHZhciBjb21taXQsIHN0YXRlLCByZXNwb25zZTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29tbWl0ID0gX3JlZjIuY29tbWl0LCBzdGF0ZSA9IF9yZWYyLnN0YXRlOwoKICAgICAgICAgICAgICAgIC8vb24gcsOpY3Vww6hyZSBsYSByw6lwb25zZSBkdSBzaWduaW4gKGxlIHRva2VuLCBvdSByaWVuIGR1IHRvdXQpCiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHRva2VuKTsKICAgICAgICAgICAgICAgIGlmICh0b2tlbikgewogICAgICAgICAgICAgICAgICBjb21taXQoJ1NFVF9UT0tFTicsIHRva2VuKTsgLy8gb24gY2hhbmdlIGxlIHN0YXRlIGVuIGFqb3V0YW50IGxlIHRva2VuCiAgICAgICAgICAgICAgICAgIC8vb24gYWpvdXRlIGxlIHRva2VuIGF1IGhlYWRlciBkYW5zIGxlIHN1YnNjcmliZXIuanMgcGR0IGxlIGNvbW1pdCBTRVRfVE9LRU4gY2FyIG9uICLDqWNvdXRlIiBsYSBtdXRhdGlvbiBkdSBjb21taXQKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoc3RhdGUudG9rZW4pIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gNDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiBheGlvcy5nZXQoJ2h0dHBzOi8vaGF1dGUtbG9pcmUub3JnL2FwaS9hdXRoL21lJyAvL29uIHRlc3RlIHNpIGxlIHRva2VuIGVzdCB2YWxpZGUKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICBjb21taXQoJ1NFVF9VU0VSJywgcmVzcG9uc2UuZGF0YSk7IC8vc2kgb3VpLCBvbiBzZXQgbGUgc3RhdGUgYXZlYyBsZXMgdXNlcnMgKHLDqXBvbnNlIGR1IGF1dGgvbWUpCgogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAxMTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IF9jb250ZXh0MlsiY2F0Y2giXSg0KTsKICAgICAgICAgICAgICAgIC8vIHRva2VuIG5vbiB2YWxpZGUgPT4gb24gc3VwcHJpbWUgbGVzIGluZm9zIHN0b2Nrw6llcyBkYW5zIFZVRSwgcGFyIG51bGwKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdmYWlsZWQgZ2V0IG1lIEFQSSByZXF1ZXN0IDopICcpOwogICAgICAgICAgICAgICAgY29tbWl0KCdTRVRfVE9LRU4nLCBudWxsKTsKICAgICAgICAgICAgICAgIGNvbW1pdCgnU0VUX1VTRVInLCBudWxsKTsKCiAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMiwgbnVsbCwgW1s0LCAxMV1dKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgc2lnbm91dDogZnVuY3Rpb24gc2lnbm91dChfcmVmMykgewogICAgICB2YXIgY29tbWl0ID0gX3JlZjMuY29tbWl0OwogICAgICByZXR1cm4gYXhpb3MucG9zdCgnaHR0cHM6Ly9oYXV0ZS1sb2lyZS5vcmcvYXBpL2F1dGgvc2lnbm91dCcpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIGNvbW1pdCgnU0VUX1RPS0VOJywgbnVsbCk7CiAgICAgICAgY29tbWl0KCdTRVRfVVNFUicsIG51bGwpOwogICAgICB9KTsKICAgIH0KICB9Cn07"},{"version":3,"sources":["/home/clement/APIetienne/bccoin/src/store/auth.js"],"names":["axios","namespaced","state","token","user","getters","authenticated","mutations","SET_TOKEN","SET_USER","actions","signin","credentials","dispatch","post","res","data","attempt","commit","get","response","console","log","signout","then"],"mappings":";;AACA,OAAOA,KAAP,MAAkB,OAAlB;AAGA,eAAe;AACXC,EAAAA,UAAU,EAAE,IADD;AAGXC,EAAAA,KAAK,EAAE;AACHC,IAAAA,KAAK,EAAE,IADJ;AAEHC,IAAAA,IAAI,EAAE;AAFH,GAHI;AAQXC,EAAAA,OAAO,EAAE;AACLC,IAAAA,aADK,yBACSJ,KADT,EACgB;AAAE;AACnB;AACA,UAAIA,KAAK,CAACC,KAAN,IAAeD,KAAK,CAACE,IAAzB,EAA+B;AAC5B,eAAO,IAAP;AACF,OAFD,MAEO;AACH,eAAO,KAAP;AACH;AACJ,KARI;AAULA,IAAAA,IAVK,gBAUAF,KAVA,EAUO;AAAE;AACV,aAAOA,KAAK,CAACE,IAAb;AACH;AAZI,GARE;AAuBXG,EAAAA,SAAS,EAAE;AACPC,IAAAA,SADO,qBACGN,KADH,EACUC,KADV,EACiB;AACpBD,MAAAA,KAAK,CAACC,KAAN,GAAcA,KAAd;AACH,KAHM;AAIPM,IAAAA,QAJO,oBAIEP,KAJF,EAISE,IAJT,EAIe;AAClBF,MAAAA,KAAK,CAACE,IAAN,GAAaA,IAAb;AACH;AANM,GAvBA;AAgCXM,EAAAA,OAAO,EAAE;AACCC,IAAAA,MADD,wBACwBC,WADxB,EACsC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA3BC,gBAAAA,QAA2B,QAA3BA,QAA2B;AAAA;AAAA,uBAEvBb,KAAK,CAACc,IAAN,CAAW,yCAAX,EAAsD;AAAE;AACpE,2BAASF,WAAW,CAAC,CAAD,CAD8C;AAElE,8BAAYA,WAAW,CAAC,CAAD;AAF2C,iBAAtD,CAFuB;;AAAA;AAEnCG,gBAAAA,GAFmC;AAAA,iDAOhCF,QAAQ,CAAC,SAAD,EAAYE,GAAG,CAACC,IAAJ,CAASb,KAArB,CAPwB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQ1C,KATI;AAWCc,IAAAA,OAXD,0BAW6Bd,KAX7B,EAWoC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAxBe,gBAAAA,MAAwB,SAAxBA,MAAwB,EAAhBhB,KAAgB,SAAhBA,KAAgB;;AAAE;AACvC;AACA,oBAAIC,KAAJ,EAAW;AACPe,kBAAAA,MAAM,CAAC,WAAD,EAAcf,KAAd,CAAN,CADO,CACqB;AAC5B;AACH;;AALoC,oBAMjCD,KAAK,CAACC,KAN2B;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA,uBAWZH,KAAK,CAACmB,GAAN,CAAU,qCAAV,CAAgD;AAAhD,iBAXY;;AAAA;AAW7BC,gBAAAA,QAX6B;AAcjCF,gBAAAA,MAAM,CAAC,UAAD,EAAaE,QAAQ,CAACJ,IAAtB,CAAN,CAdiC,CAcE;;AAdF;AAAA;;AAAA;AAAA;AAAA;AAgBvB;AACVK,gBAAAA,OAAO,CAACC,GAAR,CAAY,+BAAZ;AACAJ,gBAAAA,MAAM,CAAC,WAAD,EAAc,IAAd,CAAN;AACAA,gBAAAA,MAAM,CAAC,UAAD,EAAa,IAAb,CAAN;;AAnBiC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAqBxC,KAhCI;AAkCLK,IAAAA,OAlCK,0BAkCiB;AAAA,UAAXL,MAAW,SAAXA,MAAW;AAClB,aAAOlB,KAAK,CAACc,IAAN,CAAW,0CAAX,EAAuDU,IAAvD,CAA4D,YAAM;AACrEN,QAAAA,MAAM,CAAC,WAAD,EAAc,IAAd,CAAN;AACAA,QAAAA,MAAM,CAAC,UAAD,EAAa,IAAb,CAAN;AACH,OAHM,CAAP;AAIH;AAvCI;AAhCE,CAAf","sourcesContent":["\nimport axios from 'axios';\n\n\nexport default {\n    namespaced: true,\n\n    state: {\n        token: null,\n        user: null\n    },\n\n    getters: {\n        authenticated(state) { // retourn true si il y a un token + user dans le state, false sinon\n            //var est = false;\n            if (state.token && state.user) {\n               return true;\n            } else {\n                return false;\n            }\n        },\n\n        user(state) { //retourne l'utilisatuer\n            return state.user;\n        }\n    },\n\n    mutations: {\n        SET_TOKEN(state, token) { \n            state.token = token;\n        },\n        SET_USER(state, user) {\n            state.user = user;\n        }\n    },\n\n    actions: {\n        async signin( { dispatch } , credentials ) { // on appelle la method signin, avec email et mdp\n            \n            let res = await axios.post('https://haute-loire.org/api/auth/signin', { //vérifie si mail et mdp sont les bons\n                'email': credentials[0],\n                'password': credentials[1]\n            });\n            //console.log(res.data);\n            return dispatch('attempt', res.data.token); //en envoie le token de la réponse dans la methode attempt\n        },\n\n        async attempt( { commit, state }, token) { //on récupère la réponse du signin (le token, ou rien du tout)\n            //console.log(token);\n            if (token) {\n                commit('SET_TOKEN', token); // on change le state en ajoutant le token\n                //on ajoute le token au header dans le subscriber.js pdt le commit SET_TOKEN car on \"écoute\" la mutation du commit\n            }\n            if(!state.token) {\n                return\n            }\n\n            try {\n                let response = await axios.get('https://haute-loire.org/api/auth/me' //on teste si le token est valide\n                   \n                );\n                commit('SET_USER', response.data); //si oui, on set le state avec les users (réponse du auth/me)\n            }\n            catch (err) { // token non valide => on supprime les infos stockées dans VUE, par null\n                console.log('failed get me API request :) ');\n                commit('SET_TOKEN', null);\n                commit('SET_USER', null);\n            }\n        },\n\n        signout( { commit } ) {\n            return axios.post('https://haute-loire.org/api/auth/signout').then(() => {\n                commit('SET_TOKEN', null);\n                commit('SET_USER', null);\n            })\n        }\n    }\n}"]}]}